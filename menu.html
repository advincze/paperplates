<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/core-drag-drop/core-drag-drop.html">

<polymer-element name="pp-menuitem" attributes="name">
<template>
	<style type="text/css">
		#box {
			margin-left: 5px;
			margin-top: 5px;
			background: #eee;
			width: 150px;
			height: 50px;
		}
		span {
			position: relative;
			top:50%;
			left: 50%;
			margin-left: -63px;
		}
	</style>
	<core-drag-drop></core-drag-drop>
	<div id="box">
		<span>I'm an <b>{{name}}</b>.</span>
	</div>
</template>
<script>
	function getPlate(node) {
		
    	
    	while(node.tagName != "PP-PLATE" && node.parentNode != null) {
    		node = node.parentNode;
    	}
    	if(node.parentNode == null){
    		node = node.host;
    	}
    	if(node.tagName == "PP-PLATE"){
    		return node;
    	}

	}

	Polymer('pp-menuitem', {
		name: "apple",
		ready: function() {
			this.addEventListener('drag-start', function(e) {

				var dragInfo = e.detail;
				dragInfo.avatar.style.cssText = ' width: 100px; height: 50px; background-color: whitesmoke';
				e.detail.avatar.innerText = this.name;
				var n = this.name;
				dragInfo.drag = function() {};
				dragInfo.drop = function(x) {
					console.log("dropping "+n+ "draginfo: ");
					console.log(dragInfo);
					 var f = dragInfo.framed;
					 console.log("framed: ");
					 console.log(f);
					 var dropTarget = dragInfo.event.relatedTarget;
					 console.log(dropTarget);
				 
					 // console.log(dropTarget.parentNode);
					 // console.log(dropTarget.parentNode.host);
					 var plate = getPlate(dropTarget);
					 console.log("plate:");
					 console.log(plate);
					 plate.contents.push(n);		
					 
				};
			});
			console.log("initializing menuitem");
		}
	});
</script>
</polymer-element>
