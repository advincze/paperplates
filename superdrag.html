
<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/core-drag-drop/core-drag-drop.html">

<polymer-element name="super-drag" extends="core-drag-drop">
<script>
	function getSuperDropNode(node) {
    	while(node.tagName != "BODY" ) {
    		if(node.parentNode != null){
    			if(node.tagName == "SUPER-DROP"){
    				return node;
    			}
    			node = node.parentNode;
    		}else {
    			node = node.host;
    		}
    	}
    	return false
	}

	Polymer({
		attached: function(){
			this.super();
			this.host = this.parentNode.host || this.parentNode;
			this.addEventListener('drag-start', function(e) {
				var h  = this.host;
				if(this.dragInfo.drag == undefined){
					this.dragInfo.drag = function() {};
				}
				if(this.dragInfo.drop == undefined){
					this.dragInfo.drop = function() {};
				}
				this.fire('super-drag-start', this.dragInfo);
				var dropFun = this.dragInfo.drop;
				this.dragInfo.drop = function(dragInfo){
					var dropTarget = dragInfo.event.relatedTarget;
					var superDropNode = getSuperDropNode(dropTarget);
					if(superDropNode!=undefined){
						var eventName = "super-drop";
						if(h.localName!=undefined){
							eventName += "-"+h.localName;
						}
						superDropNode.fire(eventName, h);	
					}
					dropFun()
				}
			});
		}
	});
</script>
</polymer-element>